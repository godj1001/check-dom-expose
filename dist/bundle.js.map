{"version":3,"file":"bundle.js","sources":["../util/index.js","../index.js"],"sourcesContent":[" /**\n * 节流\n */\n export const throttle = function (time = 1) {\n  let date = null\n  return (fn) => {\n    let newTime = new Date().getTime()\n    if (newTime > date + (time * 300) || !date) {\n      date = newTime\n      fn()\n    }\n  }\n}\n\nexport const checkExpose = (childScrollTop,childScrollBottom,clientHeight,scrollTop) => {\n  if (childScrollTop > scrollTop + clientHeight && childScrollBottom > scrollTop){\n    return false\n  }\n  return  true\n}\n","/**\n * dom expose check\n * @param root {Element}\n * @param children {Element[]}\n */\nimport {throttle,checkExpose} from './util/index';\n\nconst DomExpose = (root,children) => {\n  console.log(root,children)\n  /**\n   * check\n   */\n  if (!(root instanceof Element) ){\n    console.error(`${root} is not element`)\n    return\n  }\n  if (!Array.isArray(children)){\n    console.error(`${children} is not array`)\n    return;\n  }\n  if (!children.every((child) => {\n    return child instanceof Element\n  })){\n    console.error(`${children} is not element array`)\n    return\n  }\n  /**\n   * sort children\n   */\n  let localChildren = children.sort((a,b) => {\n    return a.offsetTop - b.offsetTop\n  })\n\n  console.log('localChildren',localChildren)\n  /**\n   * rebuild children node\n   */\n   let newChildren = []\n   localChildren.forEach(child => {\n    newChildren.push({\n      id: child.id,\n      scrollBottom: child.offsetTop - root.offsetTop +child.offsetHeight,\n      scrollTop: child.offsetTop - root.offsetTop,\n      expose: false\n    })\n  })\n  console.log('localChildren2',newChildren)\n\n  const clientHeight = root.clientHeight\n  const scrollTop = root.scrollTop\n  const offsetTop = root.offsetTop\n  for (let child of localChildren){\n    if (child.scrollTop<scrollTop+clientHeight){\n      child.expose = false\n      continue\n    }\n    if (child.scrollBottom > scrollTop ){\n      child.expose = false\n      continue\n    }\n    child.expose = true\n  }\n  let fn = throttle()\n  /**\n   * get root and children dom\n   */\n  root.addEventListener('scroll',(e) => {\n    fn(() => {\n      for (let child of newChildren){\n        let expose = checkExpose(child.scrollTop,child.scrollBottom,clientHeight,root.scrollTop,offsetTop)\n        if (child.expose !== expose){\n          window.dispatchEvent(new CustomEvent('domExpose',{\n            'detail': {\n              element: child,\n              domExpose: expose\n            },\n            bubbles: false,\n            cancelable: false\n          }))\n          child.expose = expose\n        }\n      }\n    })\n  })\n}\n\nconst closeDomExpose = (root) => {\n  root.removeEventListener('scroll')\n}\n\nexport {\n  DomExpose,\n  closeDomExpose\n}\n"],"names":["throttle","time","date","fn","newTime","Date","getTime","checkExpose","childScrollTop","childScrollBottom","clientHeight","scrollTop","DomExpose","root","children","console","log","Element","error","Array","isArray","every","child","localChildren","sort","a","b","offsetTop","newChildren","forEach","push","id","scrollBottom","offsetHeight","expose","addEventListener","e","window","dispatchEvent","CustomEvent","element","domExpose","bubbles","cancelable","closeDomExpose","removeEventListener"],"mappings":"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"}